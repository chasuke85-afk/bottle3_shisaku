<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ€§ç™–ç“¶ã‚¯ã‚¤ã‚º - SEIHEKI BIN QUIZ</title>
    <style>
        :root { --bg: #fdfbfb; --accent: #ff4d79; --blue: #6366f1; }
        * { -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; box-sizing: border-box; }
        input[type="text"], textarea { -webkit-user-select: text; user-select: text; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem; padding: 10px; }

        body { font-family: sans-serif; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 0; color: #444; margin: 0; padding-top: 60px; }
        
        /* ãƒŠãƒ“ */
        .g-nav { position: fixed; top: 0; width: 100%; height: 50px; background: #fff; display: flex; border-bottom: 1px solid #eee; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav-item { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; color: #aaa; cursor: pointer; }
        .nav-item.active { color: var(--accent); border-bottom: 3px solid var(--accent); background: #fffafa; }

        /* ç™ºè¡Œã‚¨ãƒªã‚¢ï¼šURLã§ã¯ãªãåˆè¨€è‘‰ã‚’å‡ºã™ */
        #codeDisplayArea { display: none; margin: 15px; padding: 20px; background: #fff; border: 3px solid var(--accent); border-radius: 15px; width: 90%; max-width: 450px; text-align: center; }
        #quizCode { background: #f0f0f0; padding: 15px; border-radius: 8px; word-break: break-all; font-size: 0.8rem; font-family: monospace; user-select: all; -webkit-user-select: all; margin: 10px 0; border: 1px solid #ccc; max-height: 100px; overflow-y: auto; }
        
        .box-common { width: 94%; max-width: 500px; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); background: white; }
        .chip { font-size: 0.75rem; padding: 6px 12px; border-radius: 20px; background: #eee; cursor: pointer; display: inline-block; margin: 2px; }
        .chip.selected { background: var(--accent); color: white; }

        .container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 96%; max-width: 800px; padding-bottom: 20px; }
        .bottle-card { background: white; border-radius: 18px; padding: 15px 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.07); text-align: center; position: relative; }
        .bottle-frame { width: 60px; height: 90px; border: 3px solid #333; border-radius: 4px 4px 20px 20px; margin: 10px auto; position: relative; overflow: hidden; background: #f0f0f0; }
        .liquid { position: absolute; bottom: 0; width: 100%; transition: height 0.2s; }
        .p-btn { width: 35px; height: 35px; border-radius: 50%; border: none; background: #eee; font-size: 1rem; cursor: pointer; }

        .btn-main { background: var(--accent); color: white; width: 90%; max-width: 350px; margin: 20px 0; font-size: 1.1rem; border-radius: 30px; border: none; font-weight: bold; height: 55px; }
    </style>
</head>
<body>

    <nav class="g-nav">
        <div class="nav-item active" id="nav-make" onclick="location.reload()">ã‚¯ã‚¤ã‚ºã‚’ä½œã‚‹</div>
        <div class="nav-item" id="nav-solve" onclick="showInputModal()">ã‚¯ã‚¤ã‚ºã‚’è§£ã</div>
    </nav>

    <div id="setupView" style="width:100%; display:flex; flex-direction:column; align-items:center;">
        <div id="codeDisplayArea">
            <b style="color:var(--accent);">ã€åˆè¨€è‘‰ãŒç™ºè¡Œã•ã‚Œã¾ã—ãŸã€‘</b><br>
            <p style="font-size:0.8rem;">ä¸‹ã®ã€Œåˆè¨€è‘‰ã€ã‚’å…¨éƒ¨ã‚³ãƒ”ãƒ¼ã—ã¦å‹é”ã«é€ã£ã¦ã­ï¼</p>
            <div id="quizCode"></div>
            <button onclick="copyCode()" id="copyBtn" style="background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:20px; font-weight:bold;">åˆè¨€è‘‰ã‚’ã‚³ãƒ”ãƒ¼</button>
        </div>

        <div class="box-common" id="makeBox">
            <span style="font-size:0.9rem; font-weight:bold;">ğŸ¾ ç“¶ã‚’é¸ã¶</span>
            <div id="presetArea" style="margin-top:10px;"></div>
            <button class="btn-main" onclick="generateCode()">âš¡ï¸ åˆè¨€è‘‰ã‚’ç™ºè¡Œã™ã‚‹</button>
        </div>

        <div class="container" id="bottleContainer"></div>
    </div>

    <script>
        const ITEMS = ['é•·èº«','å°æŸ„','è¤è‰²','è²§ä¹³','å·¨ä¹³','ãŠå°»','å¤ªã‚‚ã‚‚','ãƒãƒ‹ãƒ†','ãƒ„ã‚¤ãƒ³ãƒ†','ãŠå§‰ã•ã‚“','å¦¹','ã‚®ãƒ£ãƒ«','æ¸…æ¥š','åœ°é›·ç³»','ãƒ„ãƒ³ãƒ‡ãƒ¬','å›ã','ç·Šç¸›','M','S','ãƒã‚°'];
        const COLORS = { pink: '#ff5d8f', blue: '#6366f1' };
        let selectedItems = [];

        window.onload = () => {
            const area = document.getElementById('presetArea');
            ITEMS.forEach(name => {
                const chip = document.createElement('div');
                chip.className = 'chip'; chip.innerText = name; chip.id = 'chip-'+name;
                chip.onclick = () => toggleItem(name);
                area.appendChild(chip);
            });
            // å¾©æ´»æ©Ÿèƒ½
            const saved = localStorage.getItem('seiheki_v3');
            if(saved) {
                selectedItems = JSON.parse(saved);
                selectedItems.forEach(i => document.getElementById('chip-'+i.name)?.classList.add('selected'));
                renderBottles();
            }
        };

        function toggleItem(name) {
            const idx = selectedItems.findIndex(i => i.name === name);
            if (idx > -1) { selectedItems.splice(idx, 1); document.getElementById('chip-'+name).classList.remove('selected'); }
            else { if(selectedItems.length >= 10) return alert("10å€‹ã¾ã§ï¼"); selectedItems.push({name, color:'pink', level:50, note:''}); document.getElementById('chip-'+name).classList.add('selected'); }
            renderBottles();
        }

        function renderBottles() {
            localStorage.setItem('seiheki_v3', JSON.stringify(selectedItems));
            const container = document.getElementById('bottleContainer');
            container.innerHTML = '';
            selectedItems.forEach((b, i) => {
                const card = document.createElement('div');
                card.className = 'bottle-card';
                card.innerHTML = `
                    <div style="font-size:0.8rem; font-weight:bold;">${b.name}</div>
                    <div style="display:flex; justify-content:center; gap:10px; margin:5px 0;">
                        <div style="width:15px;height:15px;border-radius:50%;background:${COLORS.pink};outline:${b.color==='pink'?'2px solid #333':''}" onclick="updateCol(${i},'pink')"></div>
                        <div style="width:15px;height:15px;border-radius:50%;background:${COLORS.blue};outline:${b.color==='blue'?'2px solid #333':''}" onclick="updateCol(${i},'blue')"></div>
                    </div>
                    <div class="bottle-frame"><div class="liquid" style="height:${b.level}%; background:${COLORS[b.color]}"></div></div>
                    <button class="p-btn" onclick="updateLv(${i},-10)">âˆ’</button> ${b.level}% <button class="p-btn" onclick="updateLv(${i},10)">+</button>
                    <textarea class="comment-area" style="width:100%; height:40px; font-size:0.7rem; margin-top:5px;" placeholder="è§£èª¬" onchange="selectedItems[${i}].note=this.value">${b.note}</textarea>
                `;
                container.appendChild(card);
            });
        }

        function updateLv(i, d) { selectedItems[i].level = Math.max(0, Math.min(100, selectedItems[i].level + d)); renderBottles(); }
        function updateCol(i, c) { selectedItems[i].color = c; renderBottles(); }

        // åˆè¨€è‘‰ã®ç™ºè¡Œ
        function generateCode() {
            if(selectedItems.length === 0) return alert("ç“¶ã‚’é¸ã‚“ã§ï¼");
            const pw = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ±ºã‚ã¦ã­");
            if(!pw) return;
            const data = { p: pw, b: selectedItems };
            const str = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            document.getElementById('quizCode').innerText = str;
            document.getElementById('codeDisplayArea').style.display = 'block';
            window.scrollTo(0,0);
        }

        function copyCode() {
            const code = document.getElementById('quizCode').innerText;
            const t = document.createElement("textarea"); document.body.appendChild(t); t.value = code; t.select();
            document.execCommand('copy'); document.body.removeChild(t);
            alert("åˆè¨€è‘‰ã‚’ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆï¼");
        }

        // å‹é”ãŒå…¥åŠ›ã™ã‚‹æ™‚
        function showInputModal() {
            const code = prompt("å‹é”ã‹ã‚‰å±Šã„ãŸã€Œåˆè¨€è‘‰ã€ã‚’è²¼ã‚Šä»˜ã‘ã¦ã­");
            if(!code) return;
            try {
                const data = JSON.parse(decodeURIComponent(escape(atob(code))));
                // å›ç­”ãƒ¢ãƒ¼ãƒ‰ã¸
                document.getElementById('makeBox').style.display = 'none';
                document.getElementById('nav-make').classList.remove('active');
                document.getElementById('nav-solve').classList.add('active');
                selectedItems = data.b.map(x => ({...x, level:10, note:''})); 
                renderBottles();
                const btn = document.querySelector('.btn-main');
                btn.innerText = "ç­”ãˆåˆã‚ã›ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ï¼‰";
                btn.onclick = () => {
                    if(prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ï¼Ÿ") === data.p) {
                        alert("æ­£è§£ã‚’è¡¨ç¤ºã—ã¾ã™ï¼");
                        // ã“ã“ã§æ¯”è¼ƒãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                        location.reload(); // ä»Šå›ã¯ãƒªã‚»ãƒƒãƒˆ
                    } else { alert("é•ã†ã‚ˆï¼"); }
                };
            } catch(e) { alert("åˆè¨€è‘‰ãŒæ­£ã—ããªã„ã¿ãŸã„â€¦"); }
        }
    </script>
</body>
</html>
